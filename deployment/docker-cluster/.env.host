# ===============================================
# EchoMind Docker Cluster Configuration
# TEMPLATE FILE for Production/Host Deployment
# ===============================================
#
# ⚠️  IMPORTANT: This is a TEMPLATE file with placeholder values.
#
# SETUP INSTRUCTIONS:
#   1. Copy this file to .env:
#      cp .env.host .env
#
#   2. Edit .env and replace ALL placeholder values:
#      - CHANGE_ME_* values MUST be replaced with real secrets
#      - your-domain.example.com → your actual domain
#      - Generate secrets with: openssl rand -hex 32
#
#   3. NEVER commit .env to version control (.env is gitignored)
#      Only .env.host (this template) should be in git
#
# NOTES:
#   - cluster.sh now uses .env for BOTH --local and --host modes
#   - .env.host is just a template (safe to commit)
#   - .env contains real secrets (gitignored, never commit!)
#
# ===============================================

# ===============================================
# HuggingFace Access Token (for Docker build)
# ===============================================
# CRITICAL: Used at BUILD TIME to pre-download models into Docker images
# Get token at: https://huggingface.co/settings/tokens (Select "Read" role)
# Leave empty to download without auth (may hit rate limits)
HF_TOKEN=

# Enables the observability stack
ENABLE_OBSERVABILITY=true

# ===============================================
# Versioning
# ===============================================
# Main version for Docker Hub releases
ECHOMIND_VERSION=0.1.0-beta.5

# Per-service versions (for independent versioning if needed)
API_VERSION=${ECHOMIND_VERSION}
MIGRATION_VERSION=${ECHOMIND_VERSION}
EMBEDDER_VERSION=${ECHOMIND_VERSION}
ORCHESTRATOR_VERSION=${ECHOMIND_VERSION}
CONNECTOR_VERSION=${ECHOMIND_VERSION}
INGESTOR_VERSION=${ECHOMIND_VERSION}
GUARDIAN_VERSION=${ECHOMIND_VERSION}
PROJECTOR_VERSION=${ECHOMIND_VERSION}
WEBUI_VERSION=${ECHOMIND_VERSION}

# ===============================================
# Paths (relative to docker-compose.yml location)
# ===============================================
CONFIG_PATH=../../config
DATA_PATH=../../data

# ===============================================
# Domain Configuration
# ===============================================
# Base domain - all subdomains are derived from this
# EXAMPLE: demo.echomind.ch, app.yourcompany.com, etc.
DOMAIN=your-domain.example.com

# Subdomains (derived from DOMAIN)
AUTHENTIK_DOMAIN=auth.${DOMAIN}
API_DOMAIN=api.${DOMAIN}
QDRANT_DOMAIN=qdrant.${DOMAIN}
MINIO_DOMAIN=minio.${DOMAIN}
S3_DOMAIN=s3.${DOMAIN}
PORTAINER_DOMAIN=portainer.${DOMAIN}
POSTGRES_DOMAIN=postgres.${DOMAIN}
NATS_DOMAIN=nats.${DOMAIN}
GRAFANA_DOMAIN=grafana.${DOMAIN}
PROMETHEUS_DOMAIN=prometheus.${DOMAIN}
TENSORBOARD_DOMAIN=tensorboard.${DOMAIN}

# ===============================================
# URL Configuration (derived from domains)
# ===============================================
# Protocol (https for production, http for local)
PROTOCOL=https

# Public URLs
WEB_URL=${PROTOCOL}://${DOMAIN}
API_URL=${PROTOCOL}://${API_DOMAIN}
AUTHENTIK_URL=${PROTOCOL}://${AUTHENTIK_DOMAIN}

# WebSocket URL (must include full path)
WS_URL=wss://${API_DOMAIN}/api/v1/ws/chat

# CORS allowed origins (comma-separated)
CORS_ORIGINS=${PROTOCOL}://${DOMAIN},${PROTOCOL}://${API_DOMAIN},http://localhost:5173,http://localhost:3000

# Timezone
TZ=Europe/Zurich

# ===============================================
# SSL Configuration (Let's Encrypt)
# ===============================================
# Your email for Let's Encrypt notifications
ACME_EMAIL=admin@your-domain.com

# ===============================================
# PostgreSQL Configuration
# ===============================================
POSTGRES_USER=echomind
POSTGRES_PASSWORD=CHANGE_ME_POSTGRES_PASSWORD
POSTGRES_DB=postgres

# Database names (created by init-db.sql)
AUTHENTIK_DB_NAME=authentik
API_DB_NAME=echomind

# ===============================================
# Authentik Configuration
# ===============================================
# Generate secret key with: openssl rand -hex 32
AUTHENTIK_SECRET_KEY=CHANGE_ME_GENERATE_RANDOM_KEY
AUTHENTIK_BOOTSTRAP_PASSWORD=CHANGE_ME_ADMIN_PASSWORD
AUTHENTIK_BOOTSTRAP_EMAIL=admin@your-domain.com

# ===============================================
# MinIO Configuration
# ===============================================
MINIO_ROOT_USER=admin
MINIO_ROOT_PASSWORD=CHANGE_ME_MINIO_PASSWORD

# ===============================================
# WebUI Build
# ===============================================
BUILD_HASH=prod

# ===============================================
# OIDC Settings (from Authentik OAuth2 Provider)
# ===============================================
# After creating the app in Authentik, set these values:
# 1. Go to Authentik Admin → Applications → Providers → Create OAuth2 Provider
# 2. Name: echomind-web
# 3. Client Type: Confidential
# 4. Client ID: (auto-generated, copy here)
# 5. Client Secret: (auto-generated, copy here)
# 6. Redirect URIs:
#    - ${WEB_URL}/auth/callback (legacy React frontend)
#    - ${WEB_URL}/oauth/oidc/callback (Open WebUI frontend)
WEB_OIDC_AUTHORITY=${AUTHENTIK_URL}/application/o/echomind-web/
WEB_OIDC_CLIENT_ID=PASTE_CLIENT_ID_FROM_AUTHENTIK
WEB_OIDC_CLIENT_SECRET=PASTE_CLIENT_SECRET_FROM_AUTHENTIK
WEB_OIDC_SCOPE="openid profile email"

# ===============================================
# API Authentication (MUST match Web OIDC settings)
# ===============================================
# These values are derived from the Authentik OAuth2 Provider
# The issuer and JWKS URL use the same provider slug as WEB_OIDC_AUTHORITY
API_AUTH_ISSUER=${WEB_OIDC_AUTHORITY}
API_AUTH_AUDIENCE=${WEB_OIDC_CLIENT_ID}
API_AUTH_JWKS_URL=http://authentik-server:9000/application/o/echomind-web/jwks/

# ===============================================
# Observability (Grafana + Prometheus + Loki)
# ===============================================
ENABLE_OBSERVABILITY=false

# ===============================================
# Langfuse v3 (LLM Observability + RAG Eval)
# ===============================================
ENABLE_LANGFUSE=true

# Security (generate each with: openssl rand -hex 32)
LANGFUSE_NEXTAUTH_SECRET=CHANGE_ME_LANGFUSE_NEXTAUTH
LANGFUSE_SALT=CHANGE_ME_LANGFUSE_SALT
LANGFUSE_ENCRYPTION_KEY=CHANGE_ME_LANGFUSE_ENCRYPTION

# ClickHouse
LANGFUSE_CLICKHOUSE_PASSWORD=CHANGE_ME_CLICKHOUSE_PASSWORD

# SDK API Keys (generated in Langfuse UI after first login)
LANGFUSE_PUBLIC_KEY=pk-lf-CHANGE_ME
LANGFUSE_SECRET_KEY=sk-lf-CHANGE_ME

# Bootstrap admin (first login)
LANGFUSE_INIT_EMAIL=admin@your-domain.com
LANGFUSE_INIT_PASSWORD=CHANGE_ME_LANGFUSE_ADMIN

# Authentik OIDC (optional - create provider in Authentik first)
LANGFUSE_OAUTH_ENABLED=false
LANGFUSE_OAUTH_CLIENT_ID=
LANGFUSE_OAUTH_CLIENT_SECRET=

# Subdomain
LANGFUSE_DOMAIN=langfuse.${DOMAIN}

# RAGAS Evaluation
RAGAS_SAMPLE_RATE=0.1

# ===============================================
# Google OAuth (for Google Workspace Connectors)
# ===============================================
# Follow setup guide: docs/setup/google-oauth-setup.md
# Required for Google Drive, Gmail, Calendar, Contacts connectors
# Get credentials from: https://console.cloud.google.com/apis/credentials
API_GOOGLE_CLIENT_ID=
API_GOOGLE_CLIENT_SECRET=
API_GOOGLE_REDIRECT_URI=https://${DOMAIN}/api/v1/google/auth/callback
API_OAUTH_FRONTEND_URL=https://${DOMAIN}

# Grafana admin password (used for basic auth login)
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD

# Grafana Authentik OIDC (optional — see config/observability/README.md)
# Set GRAFANA_OAUTH_ENABLED=true after creating provider in Authentik
GRAFANA_OAUTH_ENABLED=false
GRAFANA_OAUTH_CLIENT_ID=
GRAFANA_OAUTH_CLIENT_SECRET=
